{
  "metadata": {
    "total_cells": 8,
    "notebook_path": "TDS_Automation_V2.ipynb",
    "last_scan": "2025-08-14T17:14:18.292881",
    "version": "3.0",
    "repository": "rjshvjy/tds-automation",
    "type": "widget_based",
    "flow_type": "branching",
    "commit_hash": "c1ef68a891837f4403be2f31192282384f0900b9"
  },
  "cells": {
    "cell_1": {
      "index": 1,
      "title": "Install required libraries and import modules",
      "status": "unknown",
      "imports": [
        "import PyPDF2",
        "import pandas as pd",
        "import numpy as np",
        "import re",
        "import os",
        "from datetime import datetime",
        "import openpyxl",
        "from openpyxl import load_workbook",
        "from openpyxl.utils import get_column_letter",
        "from openpyxl.styles import Font, Alignment, Border, Side",
        "import warnings"
      ],
      "defines": {
        "functions": [],
        "classes": []
      },
      "calls": [
        "filterwarnings",
        "print"
      ],
      "dependencies": {
        "backward": [],
        "forward": []
      },
      "issues": [],
      "mapping_related": false
    },
    "cell_2": {
      "index": 2,
      "title": "Functions to extract data from PDF challans - FIXED AMOUNT EXTRACTION",
      "status": "unknown",
      "imports": [],
      "defines": {
        "functions": [
          "extract_challan_data_from_pdf",
          "extract_all_challans",
          "test_extraction"
        ],
        "classes": []
      },
      "calls": [
        "print",
        "extract_challan_data_from_pdf",
        "search",
        "extract_text",
        "group",
        "len",
        "replace",
        "endswith",
        "append",
        "open",
        "PdfReader",
        "test_extraction",
        "extract_all_challans",
        "str",
        "float",
        "upper",
        "get",
        "sorted",
        "items",
        "zfill",
        "join",
        "strip",
        "basename",
        "lower",
        "listdir"
      ],
      "dependencies": {
        "backward": [],
        "forward": []
      },
      "issues": [
        "Contains leading_zeros pattern",
        "Contains string_preserve pattern"
      ],
      "mapping_related": true
    },
    "cell_3": {
      "index": 3,
      "title": "Functions to read and update Excel files - FIXED WITH PROPER COLUMN CODES AND TDS PRESERVATION",
      "status": "unknown",
      "imports": [
        "import math",
        "from decimal import Decimal, ROUND_HALF_UP",
        "import traceback",
        "import traceback",
        "import traceback"
      ],
      "defines": {
        "functions": [
          "read_tds_masters",
          "update_tds_masters_with_challans",
          "validate_tds_totals"
        ],
        "classes": []
      },
      "calls": [
        "close",
        "iter_rows",
        "print",
        "int",
        "startswith",
        "quantize",
        "notna",
        "search",
        "load_workbook",
        "enumerate",
        "group",
        "replace",
        "len",
        "append",
        "print_exc",
        "update_tds_masters_with_challans",
        "str",
        "match",
        "validate_tds_totals",
        "list",
        "Decimal",
        "min",
        "iterrows",
        "range",
        "DataFrame",
        "cell",
        "to_numeric",
        "astype",
        "read_excel",
        "strptime",
        "get",
        "keys",
        "sorted",
        "to_datetime",
        "items",
        "save",
        "strip",
        "lower",
        "any",
        "abs",
        "apply",
        "read_tds_masters",
        "set"
      ],
      "dependencies": {
        "backward": [],
        "forward": []
      },
      "issues": [
        "Contains nan_values pattern",
        "Contains date_format pattern",
        "Contains rate_conversion pattern",
        "Contains round_up pattern",
        "Contains string_preserve pattern"
      ],
      "mapping_related": true,
      "column_references": [
        "(415)",
        "(415A)",
        "(416)",
        "(417)",
        "(418)",
        "(419)",
        "(421)",
        "(425D)",
        "(425E)",
        "(425F)",
        "(427)"
      ]
    },
    "cell_4": {
      "index": 4,
      "title": "Main processing function that coordinates all steps",
      "status": "unknown",
      "imports": [
        "import math",
        "from decimal import Decimal, ROUND_HALF_UP"
      ],
      "defines": {
        "functions": [
          "get_output_filename_from_masters",
          "update_deductee_breakup",
          "update_challan_details",
          "process_tds_returns"
        ],
        "classes": []
      },
      "calls": [
        "close",
        "strftime",
        "read_tds_masters",
        "iter_rows",
        "print",
        "int",
        "update_deductee_breakup",
        "to_pydatetime",
        "isinstance",
        "process_tds_returns",
        "quantize",
        "max",
        "delete_rows",
        "load_workbook",
        "enumerate",
        "replace",
        "len",
        "append",
        "insert_rows",
        "dropna",
        "update_tds_masters_with_challans",
        "extract_all_challans",
        "str",
        "validate_tds_totals",
        "iterrows",
        "range",
        "cell",
        "places",
        "float",
        "strptime",
        "get",
        "update_challan_details",
        "to_datetime",
        "items",
        "join",
        "get_output_filename_from_masters",
        "save",
        "lower",
        "strip",
        "any",
        "now",
        "Decimal"
      ],
      "dependencies": {
        "backward": [
          "cell_3",
          "cell_2"
        ],
        "forward": []
      },
      "issues": [
        "Contains nan_values pattern",
        "Contains date_format pattern",
        "Contains rate_conversion pattern",
        "Contains round_up pattern",
        "Contains string_preserve pattern"
      ],
      "mapping_related": true,
      "column_references": [
        "(415)",
        "(415A)",
        "(416)",
        "(417)",
        "(418)",
        "(419)",
        "(421)",
        "(427)"
      ]
    },
    "cell_5": {
      "index": 5,
      "title": "Functions to generate output file - COMPLETE FIX",
      "status": "unknown",
      "imports": [
        "import math  # Import math module for ceiling function",
        "import traceback"
      ],
      "defines": {
        "functions": [
          "generate_output_file",
          "find_totals_row",
          "update_challan_details_proper",
          "update_deductee_breakup_sheet_dynamic"
        ],
        "classes": []
      },
      "calls": [
        "close",
        "print",
        "Font",
        "isinstance",
        "startswith",
        "notna",
        "delete_rows",
        "load_workbook",
        "isalpha",
        "enumerate",
        "update_deductee_breakup_sheet_dynamic",
        "len",
        "replace",
        "generate_output_file",
        "print_exc",
        "insert_rows",
        "isdigit",
        "str",
        "iterrows",
        "range",
        "find_totals_row",
        "cell",
        "astype",
        "float",
        "totals",
        "strptime",
        "upper",
        "get",
        "zfill",
        "save",
        "update_challan_details_proper",
        "lower",
        "strip",
        "min",
        "ceil"
      ],
      "dependencies": {
        "backward": [],
        "forward": []
      },
      "issues": [
        "Contains nan_values pattern",
        "Contains leading_zeros pattern",
        "Contains date_format pattern",
        "Contains rate_conversion pattern",
        "Contains round_up pattern",
        "Contains string_preserve pattern"
      ],
      "mapping_related": false,
      "column_references": [
        "(415)",
        "(415A)",
        "(416)",
        "(417)",
        "(418)",
        "(419)",
        "(420)",
        "(421)",
        "(425D)",
        "(425E)",
        "(425F)",
        "(427)"
      ]
    },
    "cell_6": {
      "index": 6,
      "title": "Testing individual components and troubleshooting - FIXED VERSION",
      "status": "unknown",
      "imports": [
        "from collections import Counter"
      ],
      "defines": {
        "functions": [
          "test_pdf_extraction_single",
          "test_pdf_deduplication",
          "test_tds_masters_reading",
          "test_date_extraction",
          "create_test_summary"
        ],
        "classes": []
      },
      "calls": [
        "print",
        "notna",
        "extract_challan_data_from_pdf",
        "test_tds_masters_reading",
        "enumerate",
        "endswith",
        "replace",
        "Counter",
        "append",
        "dropna",
        "test_date_extraction",
        "extract_all_challans",
        "str",
        "iterrows",
        "most_common",
        "float",
        "get",
        "sorted",
        "to_datetime",
        "items",
        "test_pdf_extraction_single",
        "create_test_summary",
        "join",
        "get_output_filename_from_masters",
        "lower",
        "strip",
        "abs",
        "test_pdf_deduplication",
        "listdir",
        "head",
        "read_tds_masters",
        "ceil"
      ],
      "dependencies": {
        "backward": [
          "cell_4",
          "cell_3",
          "cell_2"
        ],
        "forward": []
      },
      "issues": [
        "Contains nan_values pattern",
        "Contains leading_zeros pattern",
        "Contains date_format pattern",
        "Contains rate_conversion pattern",
        "Contains round_up pattern",
        "Contains string_preserve pattern"
      ],
      "mapping_related": true,
      "column_references": [
        "(415)",
        "(415A)",
        "(416)",
        "(417)",
        "(418)",
        "(419)",
        "(421)",
        "(427)"
      ]
    },
    "cell_7": {
      "index": 7,
      "title": "Interactive file upload and processing",
      "status": "unknown",
      "imports": [
        "import os",
        "import zipfile",
        "import shutil",
        "from google.colab import files",
        "import pandas as pd",
        "from datetime import datetime"
      ],
      "defines": {
        "functions": [
          "clear_uploads",
          "upload_zip_file",
          "process_uploaded_files",
          "start_interactive_upload"
        ],
        "classes": []
      },
      "calls": [
        "makedirs",
        "print",
        "process_tds_returns",
        "startswith",
        "extract_challan_data_from_pdf",
        "endswith",
        "remove",
        "open",
        "ZipFile",
        "append",
        "start_interactive_upload",
        "download",
        "extractall",
        "upload_zip_file",
        "exists",
        "upload",
        "write",
        "rmtree",
        "move",
        "process_uploaded_files",
        "get",
        "clear_uploads",
        "items",
        "walk",
        "join",
        "lower"
      ],
      "dependencies": {
        "backward": [
          "cell_4",
          "cell_2"
        ],
        "forward": []
      },
      "issues": [
        "Contains nan_values pattern",
        "Contains leading_zeros pattern",
        "Contains rate_conversion pattern",
        "Contains round_up pattern",
        "Contains string_preserve pattern"
      ],
      "mapping_related": true,
      "column_references": [
        "(427)"
      ]
    }
  },
  "dependency_graph": {
    "execution_order": [
      1,
      2,
      3,
      4,
      5,
      6,
      7
    ],
    "definitions": {
      "extract_challan_data_from_pdf": "cell_2",
      "extract_all_challans": "cell_2",
      "test_extraction": "cell_2",
      "read_tds_masters": "cell_3",
      "update_tds_masters_with_challans": "cell_3",
      "validate_tds_totals": "cell_3",
      "get_output_filename_from_masters": "cell_4",
      "update_deductee_breakup": "cell_4",
      "update_challan_details": "cell_4",
      "process_tds_returns": "cell_4",
      "generate_output_file": "cell_5",
      "find_totals_row": "cell_5",
      "update_challan_details_proper": "cell_5",
      "update_deductee_breakup_sheet_dynamic": "cell_5",
      "test_pdf_extraction_single": "cell_6",
      "test_pdf_deduplication": "cell_6",
      "test_tds_masters_reading": "cell_6",
      "test_date_extraction": "cell_6",
      "create_test_summary": "cell_6",
      "clear_uploads": "cell_7",
      "upload_zip_file": "cell_7",
      "process_uploaded_files": "cell_7",
      "start_interactive_upload": "cell_7"
    },
    "forward_dependencies": 0
  },
  "mapping_pipeline": {
    "pdf_extraction": {
      "functions": [
        {
          "cell": "cell_2",
          "functions": [
            "extract_challan_data_from_pdf",
            "extract_all_challans",
            "test_extraction"
          ]
        },
        {
          "cell": "cell_6",
          "functions": [
            "test_pdf_extraction_single",
            "test_pdf_deduplication",
            "test_tds_masters_reading",
            "test_date_extraction",
            "create_test_summary"
          ]
        },
        {
          "cell": "cell_7",
          "functions": [
            "clear_uploads",
            "upload_zip_file",
            "process_uploaded_files",
            "start_interactive_upload"
          ]
        }
      ],
      "input_fields": [
        "bsr_code",
        "challan_no",
        "bsr_code",
        "challan_no",
        "bsr_code",
        "challan_no",
        "challan_no",
        "challan_no",
        "challan_no",
        "challan_no",
        "challan_no"
      ],
      "output_structure": {},
      "issues": []
    },
    "excel_processing": {
      "functions": [
        {
          "cell": "cell_1",
          "functions": []
        },
        {
          "cell": "cell_3",
          "functions": [
            "read_tds_masters",
            "update_tds_masters_with_challans",
            "validate_tds_totals"
          ]
        },
        {
          "cell": "cell_4",
          "functions": [
            "get_output_filename_from_masters",
            "update_deductee_breakup",
            "update_challan_details",
            "process_tds_returns"
          ]
        },
        {
          "cell": "cell_5",
          "functions": [
            "generate_output_file",
            "find_totals_row",
            "update_challan_details_proper",
            "update_deductee_breakup_sheet_dynamic"
          ]
        },
        {
          "cell": "cell_6",
          "functions": [
            "test_pdf_extraction_single",
            "test_pdf_deduplication",
            "test_tds_masters_reading",
            "test_date_extraction",
            "create_test_summary"
          ]
        },
        {
          "cell": "cell_7",
          "functions": [
            "clear_uploads",
            "upload_zip_file",
            "process_uploaded_files",
            "start_interactive_upload"
          ]
        }
      ],
      "column_mappings": {
        "(415)": "Deductee Code",
        "(415A)": "Section/Nature of Payment",
        "(416)": "PAN",
        "(417)": "Name",
        "(418)": "Date of Payment",
        "(419)": "Amount Paid",
        "(420)": "Paid by Book Entry",
        "(421)": "TDS Amount",
        "(425D)": "BSR Code",
        "(425E)": "Challan Serial No",
        "(425F)": "Date Deposited",
        "(427)": "Rate"
      },
      "transformations": [
        "Amount rounding up",
        "Date formatting",
        "Amount rounding up",
        "Date formatting",
        "Date formatting",
        "Date formatting"
      ],
      "issues": []
    },
    "validation": {
      "mandatory_fields": 20,
      "validation_functions": [
        {
          "cell": "cell_3",
          "functions": [
            "read_tds_masters",
            "update_tds_masters_with_challans",
            "validate_tds_totals"
          ]
        },
        {
          "cell": "cell_4",
          "functions": [
            "get_output_filename_from_masters",
            "update_deductee_breakup",
            "update_challan_details",
            "process_tds_returns"
          ]
        },
        {
          "cell": "cell_5",
          "functions": [
            "generate_output_file",
            "find_totals_row",
            "update_challan_details_proper",
            "update_deductee_breakup_sheet_dynamic"
          ]
        }
      ],
      "issues": []
    }
  },
  "issues": {
    "critical": [],
    "warnings": [
      "Function not found in expected location: GovernmentTemplateBuilder (Template generation)",
      "Function not found in expected location: ValidationEngine (Field validation)",
      "Function not found in expected location: ReconciliationReport (Report generation)",
      "Undefined function called: makedirs",
      "Undefined function called: iter_rows",
      "Undefined function called: quantize",
      "Undefined function called: max",
      "Undefined function called: delete_rows",
      "Undefined function called: isalpha",
      "Undefined function called: extract_text",
      "Undefined function called: group",
      "Undefined function called: endswith",
      "Undefined function called: enumerate",
      "Undefined function called: append",
      "Undefined function called: insert_rows",
      "Undefined function called: print_exc",
      "Undefined function called: download",
      "Undefined function called: isdigit",
      "Undefined function called: PdfReader",
      "Undefined function called: filterwarnings",
      "Undefined function called: list",
      "Undefined function called: match",
      "Undefined function called: min",
      "Undefined function called: most_common",
      "Undefined function called: DataFrame",
      "Undefined function called: write",
      "Undefined function called: cell",
      "Undefined function called: to_numeric",
      "Undefined function called: astype",
      "Undefined function called: read_excel",
      "Undefined function called: totals",
      "Undefined function called: upper",
      "Undefined function called: keys",
      "Undefined function called: zfill",
      "Undefined function called: walk",
      "Undefined function called: save",
      "Undefined function called: lower",
      "Undefined function called: strip",
      "Undefined function called: any",
      "Undefined function called: basename",
      "Undefined function called: listdir",
      "Undefined function called: strftime",
      "Undefined function called: now",
      "Undefined function called: set",
      "Undefined function called: close",
      "Undefined function called: Font",
      "Undefined function called: to_pydatetime",
      "Undefined function called: notna",
      "Undefined function called: startswith",
      "Undefined function called: search",
      "Undefined function called: load_workbook",
      "Undefined function called: replace",
      "Undefined function called: Counter",
      "Undefined function called: remove",
      "Undefined function called: dropna",
      "Undefined function called: ZipFile",
      "Undefined function called: extractall",
      "Undefined function called: head",
      "Undefined function called: iterrows",
      "Undefined function called: exists",
      "Undefined function called: upload",
      "Undefined function called: places",
      "Undefined function called: rmtree",
      "Undefined function called: strptime",
      "Undefined function called: move",
      "Undefined function called: get",
      "Undefined function called: sorted",
      "Undefined function called: to_datetime",
      "Undefined function called: items",
      "Undefined function called: join",
      "Undefined function called: abs",
      "Undefined function called: apply",
      "Undefined function called: Decimal",
      "Undefined function called: ceil"
    ],
    "mapping_issues": [],
    "fixed": []
  },
  "pdf_excel_flow": {},
  "test_coverage": {
    "test_functions": [
      "test_extraction",
      "test_pdf_extraction_single",
      "test_pdf_deduplication",
      "test_tds_masters_reading",
      "test_date_extraction"
    ],
    "coverage_count": 5,
    "has_pdf_tests": true,
    "has_excel_tests": true,
    "has_validation_tests": false
  }
}