{
  "metadata": {
    "notebook_version": "V2",
    "last_analyzed": "2024-01-15",
    "github_integration_ready": false
  },
  
  "implementation_details": {
    "cell_2_pdf_extraction": {
      "main_function": "extract_challan_data_from_pdf",
      "input": "pdf_path (string)",
      "output_schema": {
        "tan": "string",
        "nature_of_payment": "string (e.g., '94A', '94C')",
        "bsr_code": "string (7 digits with leading zeros)",
        "challan_no": "string (preserved leading zeros)",
        "tax_amount": "string (numeric)",
        "tender_date": "string (DD/MM/YYYY)"
      },
      "regex_patterns_used": {
        "nature_of_payment": "r'Nature of Payment\\s*:\\s*(\\d+[A-Z])'",
        "bsr_code": "r'BSR code\\s*:\\s*([\\d]+)'"
      },
      "deduplication_logic": "By challan_no using dict"
    },
    
    "cell_3_excel_processing": {
      "critical_function": "read_tds_masters",
      "uses_openpyxl": true,
      "data_only_mode": true,
      "decimal_handling": "Decimal with ROUND_HALF_UP",
      "column_search_strategy": [
        "1. Look for (code) format in row 2",
        "2. Look for -code format",  
        "3. Fallback to column name matching"
      ]
    }
  },
  
  "data_flow": {
    "pipeline": [
      {"step": 1, "cell": 2, "output": "challan_data_list"},
      {"step": 2, "cell": 3, "output": "tds_masters_data"},
      {"step": 3, "cell": 4, "output": "updated_masters_data"},
      {"step": 4, "cell": 5, "output": "final_output_file"}
    ]
  },
  
  "github_requirements": {
    "templates_needed": [
      {
        "file": "TDS_Masters_Template.xlsx",
        "sheets": ["TDS CODES", "TDS PARTIES", "Challan Details", "TDS RATES"],
        "must_have": "Column codes in row 2"
      },
      {
        "file": "TDS_Output_Template.xlsx",
        "sheets": ["DEDUCTOR DETAILS", "CHALLAN DETAILS", "DEDUCTEE BREAK-UP"],
        "must_have": "Government format with formulas"
      }
    ],
    "api_calls": [
      "GET https://raw.githubusercontent.com/rjshvjy/tds-automation/main/templates/TDS_Masters_Template.xlsx"
    ]
  },
  
  "test_data_samples": {
    "challan_example": {
      "nature_of_payment": "94A",
      "challan_no": "06501",
      "tax_amount": "3917",
      "bsr_code": "0240020"
    },
    "validation_rules": {
      "pan_format": "^[A-Z]{5}[0-9]{4}[A-Z]$",
      "amount_tolerance": 1,
      "date_format": "DD/MM/YYYY"
    }
  }
}
